package com.opencn.mesh.endpoint;import com.alipay.sofa.runtime.api.annotation.SofaClientFactory;import com.alipay.sofa.runtime.api.client.ReferenceClient;import com.alipay.sofa.runtime.api.client.param.ReferenceParam;import com.opencn.mesh.log.PipelineLoggerFactory;import com.opencn.mesh.model.PipelineRequest;import com.opencn.mesh.model.PipelineResponse;import com.opencn.mesh.service.BizCommonService;import org.slf4j.Logger;import org.springframework.web.bind.annotation.*;@RestController("/")public class TrafficEndPoint {    private static final Logger DEFAULT_LOG = PipelineLoggerFactory.getLogger(TrafficEndPoint.class);    @SofaClientFactory    private ReferenceClient referenceClient;    @PostMapping("/req")    @ResponseBody    private PipelineResponse req(@RequestBody PipelineRequest pipelineRequest) {        ReferenceParam<BizCommonService> referenceParam = new ReferenceParam<>();        referenceParam.setInterfaceType(BizCommonService.class);        referenceParam.setUniqueId(pipelineRequest.getBizIdentify());        referenceParam.setJvmFirst(true);        BizCommonService proxy = referenceClient.reference(referenceParam);        DEFAULT_LOG.info("req param {}", pipelineRequest.getBizData());        return proxy.invoke(pipelineRequest);    }    @PostMapping("/subscribe")    @ResponseBody    private PipelineResponse subscribe(@RequestBody PipelineRequest pipelineRequest) {        ReferenceParam<BizCommonService> referenceParam = new ReferenceParam<>();        referenceParam.setInterfaceType(BizCommonService.class);        referenceParam.setUniqueId(pipelineRequest.getBizIdentify());        referenceParam.setJvmFirst(true);        BizCommonService proxy = referenceClient.reference(referenceParam);        return proxy.subscribe(pipelineRequest);    }    @PostMapping("/callback")    @ResponseBody    private PipelineResponse callback(@RequestBody PipelineRequest pipelineRequest) {        ReferenceParam<BizCommonService> referenceParam = new ReferenceParam<>();        referenceParam.setInterfaceType(BizCommonService.class);        referenceParam.setUniqueId(pipelineRequest.getBizIdentify());        referenceParam.setJvmFirst(true);        BizCommonService proxy = referenceClient.reference(referenceParam);        return proxy.callback(pipelineRequest);    }}